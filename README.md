
## 기업과제
- 기업명: 디어코퍼레이션
- 기업사이트: https://web.deering.co/
- 기업채용공고: https://www.wanted.co.kr/wd/59051

## 과제 내용

### **[필수 포함 사항]**

- READ.ME 작성
    - 프로젝트 빌드, 자세한 실행 방법 명시
    - 구현 방법과 이유에 대한 간략한 설명
    - 완료된 시스템이 배포된 서버의 주소
    - 해당 과제를 진행하면서 회고 내용 블로그 포스팅
- Swagger나 Postman을 이용하여 API 테스트 가능하도록 구현

### **[주요 평가 사항]**

- 주어진 정보를 기술적으로 설계하고 구현할 수 있는 역량
- 확장성을 고려한 시스템 설계 및 구현

### 과제 안내

디어는 사용자의 요금을 계산하기 위해 다양한 상황을 고려합니다. 

- 우선 지역별로 다양한 요금제를 적용하고 있습니다. 예를 들어 건대에서 이용하는 유저는 기본요금 790원에 분당요금 150원, 여수에서 이용하는 유저는 기본요금 300원에 분당요금 70원으로 적용됩니다.
- 할인 조건도 있습니다. 사용자가 파킹존에서 반납하는 경우 요금의 30%를 할인해주며, 사용자가 마지막 이용으로부터 30분 이내에 다시 이용하면 기본요금을 면제해줍니다.
- 벌금 조건도 있습니다. 사용자가 지역 바깥에 반납한 경우 얼마나 멀리 떨어져있는지 거리에 비례하는 벌금을 부과하며, 반납 금지로 지정된 구역에 반납하면 6,000원의 벌금을 요금에 추과로 부과합니다.
- 예외도 있는데, 킥보드가 고장나서 정상적인 이용을 못하는 경우의 유저들을 배려하여 1분 이내의 이용에는 요금을 청구하지 않고 있습니다.

- 최근에 다양한 할인과 벌금을 사용하여 지자체와 협력하는 경우가 점점 많아지고 있어 요금제에 새로운 할인/벌금 조건을 추가하는 일을 쉽게 만드려고 합니다. 어떻게 하면 앞으로 발생할 수 있는 다양한 할인과 벌금 조건을 기존의 요금제에 쉽게 추가할 수 있는 소프트웨어를 만들 수 있을까요? 

- 우선은 사용자의 이용에 관한 정보를 알려주면 현재의 요금 정책에 따라 요금을 계산해주는 API를 만들어주세요. 그 다음은, 기능을 유지한 채로 새로운 할인이나 벌금 조건이 쉽게 추가될 수 있게 코드를 개선하여 최종 코드를 만들어주세요.
----

| **이름** | **Github Link** |
|:------|:-------------|
| 정성헌 | https://github.com/Heon4856 |
| 안다민 | https://github.com/damin0320 |
| 송빈호 | https://github.com/binogood |
| 이무현 | https://github.com/PeterLEEEEEE |
| 김훈태 | https://github.com/kim-hoontae |
| 강대훈 | https://github.com/daehoon12 |



### 📚 Stack 📚
스킬: Python, Django, Mysql
배포: 네이버 클라우드
etc: postman


## 3. 기업 과제
### 배포 주소
- http://27.96.131.215:8000/
- API 테스트 Postman 문서  
  https://documenter.getpostman.com/view/14305157/UVCB9PXF
  


## 4. 다이어그램
### 클래스 다이어그램
![image](https://user-images.githubusercontent.com/32921115/142778108-d0e544a1-44c9-4fa4-8fdc-552698625f8d.png)

### 모델링
![스크린샷 2021-11-22 오후 1 48 56](https://user-images.githubusercontent.com/13060192/142802839-4d9c3936-fbd5-4721-a20a-1e1332bcd6cf.png)

특이사항: base_pricing을 따로 빼서, 추후 월 정액제 추가할 시를 대비하였음.



## 5. 출제 문제의 해석 및 풀이 의도

킥보드 요금 부과 시스템

### 1. 확장가능성에 대하여

킥보드 업체가 어디까지 확장할 것인가는 중요한 논의이다. interface에 정의되어야하는 수준이 결정되기 때문이다. 예를 들어 해당업체가 종합모빌리티 기업으로 성장하고자할때, 택시요금 같은 경우는, 거리와 시간을
모두 고려하여 가격을 책정한다. 하지만 킥보드 업체가 택시까지 커버하기에는 타다 사례등을 비추어 어려울 것이고, 택시까지 하게된다면 새로 코드를 짜는게 나을 것 같다.
따라서 우리 팀은 요금체계의 확장성은 킥보드 요금체계까지로 한정지었다. 

### 2. 요금체계에 대한 고찰

킥보드업체가 요금체계를 만든다고 하면, 결국 공간정보를 바탕으로 메기는 요금, 시간정보를 바탕으로 메기는 요금이 있다. 그런데 일단 기본 요금제는 시간을 베이스로 할 수 밖에 없다. 유저들이 킥보드를 타는 목적자체가
장거리 이동을 하기보다는 짧게 여기저기 이동하는 목적으로 사용하고, 또한 짧은 거리 이동시 gps가 그만큼 정밀한 계산을 보장하기 어렵기 때문이다.

또한 페널티에 있어서 시간을 가지고 메기는 경우는 없을 것이다. 페널티는 결국 유저에게 특정한 행동을 유도할 목적으로 설계되는 것이다. 그런데 이미 기본요금 베이스가 시간을 베이스로 하기때문에, 유저들은 빨리 반납할
유인이 있다. 결국 물류비용을 낮추거나, 부적절한 곳에 주차하는 것을 막게하기 위해서는 공간정보를 베이스로 한 페널티 정책이 필요하다. 그외 유저가 반납후 빠른 시간안에 재사용하는 경우에는 시간정보를 바탕으로
할인혜택을 줄수 있다.

마지막으로 예외정책의 경우에는 단 하나의 예외정책만 적용가능하게 설정해야한다. 예외는 말그대로 앞에 계산한 모든 요금을 무시할정도의 특수한 경우이기 때문에 여러가지가 동시에 적용된다면 요금체계의 예측가능성이 너무
떨어진다.

또한 사용자들의 예측가능성 향상을 위해, 요금은 베이스 --> 할인 --> 페널티 이런식으로 계산되어야한다.
페널티를 주는 공간과, 할인을 주는 공간은 배타적이어야한다.

이러한 생각에 비추어 각 정책에 특성에 맞게 interface로 추상화하고 상속을 받아, 확장가능성을 도모하였다.


# 6 구현 API
 요금계산 API
*HTTP Request**

```http request
POST /api/calculate-charge
content-type: "application/json"
```

**Request Body**

```json
{
       "user_name" : "test",
        "deer_name" :"test",
        "end_lat" :37.54577457976297, 
        "end_lng" : 127.0671906172461 ,
        "start_at" :"2021-11-22 03:16:10",
        "end_at" : "2021-11-22 03:16:40"
}
```



**Response**

```json
{
    "message": "SUCCESS",
    "charge_cost": "1390",
    "요금 근거": "['790: 기본 요금, 150: 분당 요금의 기본요금제']"
}
```



# 7. Reference
이 프로젝트는 원티드x위코드 백엔드 프리온보딩 과제 일환으로 디어코퍼레이션에서 출제한 과제를 기반으로 만들었습니다. 감사합니다.
